# File managed by Chef

# set this to store vendor strings.
set vendor-string = option vendor-class-identifier;

<% @allows.each do |allow| -%>
allow <%= allow %>;
<% end -%>

<% @parameters.sort.each do |key, value| -%>
  <%= key %> <%= value %>;
<% end -%>

<% @options.sort.each do |key, value| -%>
  option <%= key %> <%= value %>;
<% end -%>

<% unless @ddns.empty? -%>
key "dhcp-key" {
  algorithm hmac-md5;
  secret "L+Jl4+4onU4Wstfi4pdmnQ==";
};

  <% @ddns.each do |zone, data| -%>
zone <%= zone %>. {
  primary <%= data["master"] %>;
  key "dhcp-key";
}
  <% end -%>
<% end -%>

<% if @failover %>
failover peer "<%= node[:domain] %>" { 
  <%= @role %>; 
  address <%= @my_ip %>;     
  port 647;
  peer address <%= @peer_ip %>;
  peer port 647;
  max-response-delay 60;
  max-unacked-updates 10;
  mclt 3600;
  <% if @role =~ /primary/i -%>
  split 128;
  load balance max seconds 3;
  <% end -%>
}
<% end %>

include "<%= node[:dhcp][:dir] %>/groups.d/group_list.conf";
include "<%= node[:dhcp][:dir] %>/subnets.d/subnet_list.conf";
include "<%= node[:dhcp][:dir] %>/hosts.d/host_list.conf";

